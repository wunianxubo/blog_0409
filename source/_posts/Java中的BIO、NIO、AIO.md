---
title: Java中的BIO、NIO、AIO 
date: 2017-10-16 16:14:00  
tags: [java,java基础]    
categories: java基础  
---
## 同步和异步
同步和异步关注的是消息通信机制。  
同步：指在发出一个调用时，在没有得到结果之前，该调用就不返回。一旦返回，说明已经得到返回值了。也就是由调用者主动等待这个调用的结果。  
异步：指在调用发出之后，这个调用就直接返回了，所以没有返回结果。就是说异步过程调用发出后，调用者不会立刻得到结果，而是在调用发出后，被调用者通过状态、通知来通知调用者，或通过回调函数处理这个调用。  
## 阻塞和非阻塞
阻塞和非阻塞关注的是程序在等待调用结果（消息，返回值）时的状态。  
阻塞：阻塞调用指的是调用结果返回之前，当前线程会被挂起，调用线程只有在得到结果之后才会返回。  
非阻塞：非阻塞调用指的是不能立刻得到结果之前，该调用不会阻塞当前线程。  
在处理IO的时候，阻塞和非阻塞都是同步IO。除了特殊的API（AIO），为异步IO。  

对unix来讲：阻塞式IO，非阻塞式IO，IO复用（select/poll/epoll）都属于同步IO，因为它们在数据由内核空间复制回进程缓冲区时都是阻塞的（不能做其他事），分为两阶段：  
1、数据准备完成  
2、数据由内核空间复制回进程缓冲区  

## 同步IO和异步IO
**同步IO**：当用户发出IO请求操作后，如果数据没有就绪，需要通过用户线程或者内核不断去轮询数据是否就绪，当数据就绪时，再将数据从内核拷贝到用户线程。  
**异步IO**：只有IO请求操作的发出是用户线程来执行的，IO操作的两个阶段都是由内核自动完成，不需要不断去轮询，会发送通知告知用户线程IO操作已经完成。不会对用户线程产生阻塞。  

## 阻塞IO和非阻塞IO
阻塞IO和非阻塞IO是反映在当用户请求IO操作时，如果数据没有就绪，是用户线程一直等待数据就绪，还是会收到一个标志信息上。  

### 举个例子
老张爱喝茶，他要煮开水。  
出场任务：老张，水壶两把（普通水壶，简称水壶；会响的水壶，简称响水壶）。  
1、老张把水壶放到火上，立等水开。（同步阻塞）  
老张觉得自己有点傻  
2、老张把水壶放到火上，去客厅看电视，时不时去厨房看看水开了没有。（同步非阻塞）  
老张还是觉得自己有点傻，于是买了把会响笛的水壶。水开之后，能发出声音提醒水开了。  
3、老张把响水壶放到火上，立等水开。（异步阻塞）  
老张觉得这样傻等意义不大  
4、老张把响水壶放到火上，去客厅看电视，水壶响之前不再去看它了，响了再去拿壶。（异步非阻塞）  
老张觉得自己聪明了  
&emsp;所谓同步异步，只是针对水壶而言。普通水壶，同步；响水壶，异步。虽然都能干活，但响水壶可以在自己完工之后，提示老张水开了。同步只能让调用者去轮询自己，造成老张效率的低下。  
&emsp;所谓阻塞非阻塞，仅仅对于老张而言。立等的老张，阻塞；看电视的老张，非阻塞。情况1和3中老张是阻塞的，虽然3中响水壶是异步的，但对于立等的老张没有太大的意义。所以一般异步都是配合非阻塞使用的，这样才能发挥异步的效用。  



## I/O模型
可分为同步阻塞，同步非阻塞，异步阻塞，异步非阻塞IO。  
**同步阻塞IO**：在这种方式下，用户进程在发起一个IO操作后，必须等待IO操作的完成，只有当真正完成了IO操作以后，用户线程才能运行。  
**同步非阻塞IO**：这种方式下，用户进程在发起一个IO操作后可返回做其它事情，但是用户进程需要时不时的询问IO操作是否就绪，就要求用户进程不停的去询问，从而引入不惜要的CPU资源浪费。JAVA中NIO就属于同步非阻塞IO。  
**异步阻塞IO**：这种方式下，应用发起一个IO操作后，不等待内核IO操作的完成，等内核完成IO操作后会通知应用程序。  
**异步非阻塞IO**：这种方式下，用户进程只需要发起一个IO操作然后立即返回，等IO操作真正完成后，应用程序会得到IO操作完成的通知，此时用户进程只需要对数据进行处理就好了，不需要进行实际的IO读写操作，因为真正的IO读取和写入操作已经由内核完成了。  

## JAVA对BIO、NIO、AIO支持
**BIO**：同步阻塞，服务器实现模式为一个连接一个线程，即客户端有连接请求时服务器就需要启动一个线程进行处理，如果这个连接不做任何事情会造成不必要的线程开销，当然可以通过线程池机制改善。  
**NIO**：同步非阻塞，服务器实现模式为一个请求一个线程，即客户端发送的连接请求都会注册到多路复用器上，多路复用器轮询到连接有I/O请求时才启动一个线程进行处理。  
**AIO**：异步非阻塞，服务器实现模式为一个有效请求一个线程，客户端的I/O请求都是由OS先完成了再通知服务器应用去启动线程进行处理。  

## JAVA中BIO、NIO、AIO的适用场景
BIO：适用于连接数目比较小且固定的架构，这种方式对服务器资源要求比较高，jdk1.4前唯一的选择，但程序直观简单易理解。  
NIO：适用于连接数目多且连接比较短（轻操作）的架构，比如聊天服务器，编程比较复杂，jdk1.4开始支持。  
AIO：适用于连接数目多且连接比较长（重操作）的架构，比如相册服务器，充分调用OS参与并发操作，编程比较复杂，jdk1.7开始支持。  





